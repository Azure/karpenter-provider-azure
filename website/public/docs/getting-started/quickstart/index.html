<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.145.0">



<title>Quickstart | Karpenter for Azure</title>
<meta name="description" content="Get started with Karpenter for Azure in minutes
">

<meta property="og:url" content="//localhost:1313/docs/getting-started/quickstart/">
  <meta property="og:site_name" content="Karpenter for Azure">
  <meta property="og:title" content="Quickstart">
  <meta property="og:description" content="Get started with Karpenter for Azure in minutes">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="og:image" content="//localhost:1313/banner.png">


  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//localhost:1313/banner.png">
  <meta name="twitter:title" content="Quickstart">
  <meta name="twitter:description" content="Get started with Karpenter for Azure in minutes">






<link href="/scss/main.css" rel="stylesheet">


  </head>
  <body class="td-page">
    <header>
      <nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 500 443" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M237.704918.0C314.662629.0 377.04918 62.3865513 377.04918 139.344262L377.049 336.352 442.622951 336.351852C474.31142 336.351852 5e2 362.040432 5e2 393.728901V443h-7.546066c-18.225271.0-33.094961-14.592764-33.437541-32.814815V401.960534L459.013099 401.553891C458.795948 388.160675 447.871194 377.37037 434.42623 377.37037H106.557377c-58.8500143.0-106.557377-47.707362-106.557377-106.557377L-100611761e-22 139.344262c0-76.9577107 62.3865513-139.344262 139.344262-139.344262zm-8.196721 41.0185185H147.540984L145.778863 41.0327942C87.7415928 41.97378 40.9836066 89.3143814 40.9836066 147.575896V270.778081L40.9923916 271.862464C41.5714598 307.577706 70.7041376 336.351852 106.557377 336.351852H270.491803c36.215394.0 65.573771-29.358377 65.573771-65.573771V147.575896L336.051298 145.813774C335.110312 87.7765047 287.769711 41.0185185 229.508197 41.0185185zM147.868852 106.648148C157.213115 106.648148 164.590164 114.277593 164.590164 123.875926v49.960555l56.803279-58.574444C228.770492 108.370926 238.852459 107.878704 245.983607 114.523704V114.769815C252.868852 121.168704 252.377049 131.751481 244.754098 138.642593l-42.04918 43.315555 48.934426 69.895556C257.540984 260.467593 255.819672 271.296481 247.95082 276.464815 239.344262 281.387037 229.508197 278.679815 223.606557 270.065926l-44.016393-64.481111-15 15.751111v40.362222c0 9.84444500000001-7.377049 17.227778-16.721312 17.227778C138.52459 278.925926 131.147541 271.542593 131.147541 261.698148V123.875926c0-9.59833300000001 7.377049-17.227778 16.721311-17.227778z" id="white_square_logo" fill="#fff"/></g></svg></span><span class="navbar-brand__name">Karpenter for Azure</span></a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/docs"><i class='fas fa-book'></i><span>Docs</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="https://github.com/Azure/karpenter-provider-azure" target="_blank"><i class='fab fa-github'></i><span>GitHub</span></a>
      </li>
      <li class="nav-item dropdown mr-4 d-none d-lg-block">
        


	




<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	v1.5.5  (latest) 
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink" id="navbarVersionSelector">
	
	<a class="dropdown-item" href='/v1.5.5//getting-started/quickstart/' data-docs-version="v1.5.5">
		v1.5.5  (latest) 
	</a>
	
</div>
</li>
      </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">
    
  </div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="collapse td-sidebar-nav foldable-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docs-li">
  <a href="/docs/" title="Documentation" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-docs"><span class="">Docs</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docsgetting-started-li">
  <input type="checkbox" id="m-docsgetting-started-check" checked/>
  <label for="m-docsgetting-started-check"><a href="/docs/getting-started/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsgetting-started"><span class="">Getting Started</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-docsgetting-startedquickstart-li">
  <input type="checkbox" id="m-docsgetting-startedquickstart-check" checked/>
  <label for="m-docsgetting-startedquickstart-check"><a href="/docs/getting-started/quickstart/" class="align-left pl-0  active td-sidebar-link td-sidebar-link__page" id="m-docsgetting-startedquickstart"><span class="td-sidebar-nav-active-item">Quickstart</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsconcepts-li">
  <input type="checkbox" id="m-docsconcepts-check"/>
  <label for="m-docsconcepts-check"><a href="/docs/concepts/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsconcepts"><span class="">Concepts</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsconceptsnodepools-li">
  <input type="checkbox" id="m-docsconceptsnodepools-check"/>
  <label for="m-docsconceptsnodepools-check"><a href="/docs/concepts/nodepools/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsconceptsnodepools"><span class="">NodePools</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsconceptsnodeclasses-li">
  <input type="checkbox" id="m-docsconceptsnodeclasses-check"/>
  <label for="m-docsconceptsnodeclasses-check"><a href="/docs/concepts/nodeclasses/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsconceptsnodeclasses"><span class="">NodeClasses</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsconceptsscheduling-li">
  <input type="checkbox" id="m-docsconceptsscheduling-check"/>
  <label for="m-docsconceptsscheduling-check"><a href="/docs/concepts/scheduling/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsconceptsscheduling"><span class="">Scheduling</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsconceptsdisruption-li">
  <input type="checkbox" id="m-docsconceptsdisruption-check"/>
  <label for="m-docsconceptsdisruption-check"><a href="/docs/concepts/disruption/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsconceptsdisruption"><span class="">Disruption</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsconceptsnap-vs-self-hosted-li">
  <input type="checkbox" id="m-docsconceptsnap-vs-self-hosted-check"/>
  <label for="m-docsconceptsnap-vs-self-hosted-check"><a href="/docs/concepts/nap-vs-self-hosted/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsconceptsnap-vs-self-hosted"><span class="">NAP vs Self-Hosted</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsreference-li">
  <input type="checkbox" id="m-docsreference-check"/>
  <label for="m-docsreference-check"><a href="/docs/reference/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsreference"><span class="">Reference</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsreferencesettings-li">
  <input type="checkbox" id="m-docsreferencesettings-check"/>
  <label for="m-docsreferencesettings-check"><a href="/docs/reference/settings/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsreferencesettings"><span class="">Settings</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsreferencecustom-networking-li">
  <input type="checkbox" id="m-docsreferencecustom-networking-check"/>
  <label for="m-docsreferencecustom-networking-check"><a href="/docs/reference/custom-networking/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsreferencecustom-networking"><span class="">Custom Networking</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsreferenceinstance-types-li">
  <input type="checkbox" id="m-docsreferenceinstance-types-check"/>
  <label for="m-docsreferenceinstance-types-check"><a href="/docs/reference/instance-types/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsreferenceinstance-types"><span class="">Instance Types</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsreferencenodepool-examples-li">
  <input type="checkbox" id="m-docsreferencenodepool-examples-check"/>
  <label for="m-docsreferencenodepool-examples-check"><a href="/docs/reference/nodepool-examples/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsreferencenodepool-examples"><span class="">NodePool Examples</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsreferencenodepools-li">
  <input type="checkbox" id="m-docsreferencenodepools-check"/>
  <label for="m-docsreferencenodepools-check"><a href="/docs/reference/nodepools/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsreferencenodepools"><span class=""></span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsfaq-li">
  <input type="checkbox" id="m-docsfaq-check"/>
  <label for="m-docsfaq-check"><a href="/docs/faq/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsfaq"><span class="">FAQ</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docstroubleshooting-li">
  <input type="checkbox" id="m-docstroubleshooting-check"/>
  <label for="m-docstroubleshooting-check"><a href="/docs/troubleshooting/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docstroubleshooting"><span class="">Troubleshooting</span></a></label>
  
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href="https://github.com/Azure/karpenter-provider-azure/tree/main/website/content/en/docs/getting-started/quickstart.md" class="td-page-meta--view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
  <a href="https://github.com/Azure/karpenter-provider-azure/edit/main/website/content/en/docs/getting-started/quickstart.md" class="td-page-meta--edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  <a href="https://github.com/Azure/karpenter-provider-azure/new/main/website/content/en/docs/getting-started/quickstart.md?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
  <a href="https://github.com/Azure/karpenter-provider-azure/issues/new?title=Quickstart" class="td-page-meta--issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
  
</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#choose-your-deployment-mode">Choose Your Deployment Mode</a></li>
    <li><a href="#node-auto-provisioning-nap">Node Auto Provisioning (NAP)</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#create-aks-cluster-with-nap">Create AKS Cluster with NAP</a></li>
        <li><a href="#verify-nap-installation">Verify NAP Installation</a></li>
        <li><a href="#understanding-the-default-nodepools">Understanding the Default NodePools</a></li>
        <li><a href="#create-custom-nodepools">Create Custom NodePools</a></li>
        <li><a href="#test-autoprovisioning">Test Autoprovisioning</a></li>
        <li><a href="#clean-up-nap-cluster">Clean Up NAP Cluster</a></li>
      </ul>
    </li>
    <li><a href="#self-hosted-mode">Self-hosted Mode</a>
      <ul>
        <li><a href="#prerequisites-1">Prerequisites</a></li>
        <li><a href="#create-aks-cluster">Create AKS Cluster</a></li>
        <li><a href="#configure-workload-identity">Configure Workload Identity</a></li>
        <li><a href="#install-karpenter">Install Karpenter</a></li>
        <li><a href="#verify-installation">Verify Installation</a></li>
        <li><a href="#create-nodepool">Create NodePool</a></li>
        <li><a href="#test-autoprovisioning-1">Test Autoprovisioning</a></li>
        <li><a href="#clean-up-self-hosted">Clean Up Self-hosted</a></li>
      </ul>
    </li>
    <li><a href="#whats-next">What&rsquo;s Next?</a></li>
    <li><a href="#common-next-steps">Common Next Steps</a>
      <ul>
        <li><a href="#enable-spot-instances">Enable Spot Instances</a></li>
        <li><a href="#add-gpu-support">Add GPU Support</a></li>
        <li><a href="#multi-architecture-support">Multi-Architecture Support</a></li>
      </ul>
    </li>
    <li><a href="#getting-help">Getting Help</a></li>
  </ul>
</nav>
      </div>
    
            

	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="//localhost:1313/docs/">Docs</a>
  </li>
  <li class="breadcrumb-item">
    <a href="//localhost:1313/docs/getting-started/">Getting Started</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="//localhost:1313/docs/getting-started/quickstart/" aria-disabled="true" class="btn-link disabled">Quickstart</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>Quickstart</h1>
	<div class="lead">Get started with Karpenter for Azure in minutes</div>
	<header class="article-meta">
		

  

		
	</header>    
	<p>This quickstart will help you deploy Karpenter for Azure on your AKS cluster. Karpenter automatically provisions right-sized nodes based on your workload requirements, improving efficiency and reducing costs.</p>
<h2 id="choose-your-deployment-mode">Choose Your Deployment Mode</h2>
<p>Karpenter for Azure supports two deployment modes:</p>
<ul>
<li><strong><a href="/docs/getting-started/quickstart/#node-auto-provisioning-nap">Node Auto Provisioning (NAP)</a></strong> - Managed by AKS (Recommended)</li>
<li><strong><a href="/docs/getting-started/quickstart/#self-hosted-mode">Self-hosted</a></strong> - You manage the deployment</li>
</ul>
<h2 id="node-auto-provisioning-nap">Node Auto Provisioning (NAP)</h2>
<p>NAP is the recommended way to use Karpenter with AKS. Microsoft manages the entire Karpenter lifecycle as a managed addon.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Azure subscription</li>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli">Azure CLI</a> installed</li>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a> installed</li>
</ul>
<h3 id="create-aks-cluster-with-nap">Create AKS Cluster with NAP</h3>
<p>Set up your environment:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Set environment variables</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">CLUSTER_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>karpenter-nap-cluster
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">RESOURCE_GROUP</span><span style="color:#ce5c00;font-weight:bold">=</span>karpenter-demo
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>westus2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Login to Azure</span>
</span></span><span style="display:flex;"><span>az login
</span></span></code></pre></div><p>Create the resource group:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az group create --name <span style="color:#000">$RESOURCE_GROUP</span> --location <span style="color:#000">$LOCATION</span>
</span></span></code></pre></div><p>Create AKS cluster with NAP enabled:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az aks create <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --name <span style="color:#000">$CLUSTER_NAME</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --resource-group <span style="color:#000">$RESOURCE_GROUP</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-provisioning-mode Auto <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-provisioning-default-pools Auto <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --network-plugin azure <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --network-plugin-mode overlay <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --network-dataplane cilium <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-count <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --generate-ssh-keys <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --location <span style="color:#000">$LOCATION</span>
</span></span></code></pre></div><h4 id="understanding-default-nodepools">Understanding Default NodePools</h4>
<p>The <code>--node-provisioning-default-pools</code> flag controls which default Karpenter NodePools are created:</p>
<ul>
<li><strong><code>Auto</code></strong> (default): Creates two standard NodePools for immediate use</li>
<li><strong><code>None</code></strong>: No default NodePools are created - you must define your own</li>
</ul>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <strong>Changing from Auto to None</strong>: If you change this setting from <code>Auto</code> to <code>None</code> on an existing cluster, the default NodePools aren&rsquo;t deleted by default.

</div>

<p>Get cluster credentials:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az aks get-credentials --name <span style="color:#000">$CLUSTER_NAME</span> --resource-group <span style="color:#000">$RESOURCE_GROUP</span>
</span></span></code></pre></div><h3 id="verify-nap-installation">Verify NAP Installation</h3>
<p>Check that Karpenter is running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Verify NAP is enabled</span>
</span></span><span style="display:flex;"><span>az aks show --name <span style="color:#000">$CLUSTER_NAME</span> --resource-group <span style="color:#000">$RESOURCE_GROUP</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --query <span style="color:#4e9a06">&#34;nodeProvisioningProfile.mode&#34;</span> -o tsv
</span></span></code></pre></div><h3 id="understanding-the-default-nodepools">Understanding the Default NodePools</h3>
<p>When using <code>--node-provisioning-default-pools Auto</code> or not specifying <code>--node-provisioning-default-pools</code>, NAP automatically creates two NodePools that cannot be deleted. <code>default</code> and <code>system-surge</code>.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    <strong>Default NodePools are protected</strong>: When <code>--node-provisioning-default-pools</code> is set to <code>Auto</code>, the <code>default</code> and <code>system-surge</code> NodePools cannot be deleted and are managed by AKS. You can modify them, but not remove them.

</div>

<h3 id="create-custom-nodepools">Create Custom NodePools</h3>
<p>You can create additional NodePools for specific needs:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: karpenter.sh/v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: NodePool
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: general-purpose
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  template:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      requirements:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - key: kubernetes.io/arch
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          values: [&#34;amd64&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - key: kubernetes.io/os
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          values: [&#34;linux&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - key: karpenter.sh/capacity-type
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          values: [&#34;on-demand&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - key: karpenter.azure.com/sku-family
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          values: [&#34;D&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      nodeClassRef:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        group: karpenter.azure.com
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        kind: AKSNodeClass
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        name: default
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      expireAfter: Never
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  limits:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    cpu: 100
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  disruption:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    consolidationPolicy: WhenEmptyOrUnderutilized
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    consolidateAfter: 30s
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">---
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: karpenter.azure.com/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: AKSNodeClass
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: default
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  imageFamily: Ubuntu2204
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><h3 id="test-autoprovisioning">Test Autoprovisioning</h3>
<p>Deploy a test workload:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: inflate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  replicas: 0
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  selector:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      app: inflate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  template:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      labels:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        app: inflate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      terminationGracePeriodSeconds: 0
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      containers:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - name: inflate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          image: mcr.microsoft.com/oss/kubernetes/pause:3.6
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          resources:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">            requests:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">              cpu: 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>Scale up to see Karpenter provision nodes:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl scale deployment inflate --replicas <span style="color:#0000cf;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Watch for new nodes</span>
</span></span><span style="display:flex;"><span>kubectl get nodes -w
</span></span></code></pre></div><p>Monitor Karpenter events:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get events -A --field-selector <span style="color:#000">source</span><span style="color:#ce5c00;font-weight:bold">=</span>karpenter -w
</span></span></code></pre></div><h3 id="clean-up-nap-cluster">Clean Up NAP Cluster</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete deployment inflate
</span></span><span style="display:flex;"><span>az aks delete --name <span style="color:#000">$CLUSTER_NAME</span> --resource-group <span style="color:#000">$RESOURCE_GROUP</span> --yes --no-wait
</span></span><span style="display:flex;"><span>az group delete --name <span style="color:#000">$RESOURCE_GROUP</span> --yes --no-wait
</span></span></code></pre></div><h2 id="self-hosted-mode">Self-hosted Mode</h2>
<p>For advanced users who need more control over Karpenter configuration.</p>
<h3 id="prerequisites-1">Prerequisites</h3>
<ul>
<li>Azure subscription</li>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli">Azure CLI</a> installed</li>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a> installed</li>
<li><a href="https://helm.sh/docs/intro/install/">Helm 3.x</a> installed</li>
<li><a href="https://stedolan.github.io/jq/">jq</a> installed</li>
</ul>
<h3 id="create-aks-cluster">Create AKS Cluster</h3>
<p>Set up environment variables:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">CLUSTER_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>karpenter-self-hosted
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">RG</span><span style="color:#ce5c00;font-weight:bold">=</span>karpenter-demo
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>westus3
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">KARPENTER_NAMESPACE</span><span style="color:#ce5c00;font-weight:bold">=</span>kube-system
</span></span></code></pre></div><p>Create the resource group:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az group create --name <span style="color:#4e9a06">${</span><span style="color:#000">RG</span><span style="color:#4e9a06">}</span> --location <span style="color:#4e9a06">${</span><span style="color:#000">LOCATION</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div><p>Create managed identity for Karpenter:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">KMSI_JSON</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>az identity create --name karpentermsi --resource-group <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">RG</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --location <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">LOCATION</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>Create AKS cluster with workload identity:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">AKS_JSON</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>az aks create <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --name <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">CLUSTER_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --resource-group <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">RG</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-count <span style="color:#0000cf;font-weight:bold">3</span> --generate-ssh-keys <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --network-plugin azure --network-plugin-mode overlay --network-dataplane cilium <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --enable-managed-identity <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --enable-oidc-issuer --enable-workload-identity<span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>az aks get-credentials --name <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">CLUSTER_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --resource-group <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">RG</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --overwrite-existing
</span></span></code></pre></div><h3 id="configure-workload-identity">Configure Workload Identity</h3>
<p>Create federated credential:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az identity federated-credential create --name KARPENTER_FID --identity-name karpentermsi --resource-group <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">RG</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --issuer <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>jq -r <span style="color:#4e9a06">&#34;.oidcIssuerProfile.issuerUrl&#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$AKS_JSON</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --subject system:serviceaccount:<span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_NAMESPACE</span><span style="color:#4e9a06">}</span>:karpenter-sa <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --audience api://AzureADTokenExchange
</span></span></code></pre></div><p>Assign Azure permissions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">KARPENTER_USER_ASSIGNED_CLIENT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>jq -r <span style="color:#4e9a06">&#39;.principalId&#39;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$KMSI_JSON</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">RG_MC</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>jq -r <span style="color:#4e9a06">&#34;.nodeResourceGroup&#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$AKS_JSON</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">RG_MC_RES</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>az group show --name <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">RG_MC</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --query <span style="color:#4e9a06">&#34;id&#34;</span> -otsv<span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> role in <span style="color:#4e9a06">&#34;Virtual Machine Contributor&#34;</span> <span style="color:#4e9a06">&#34;Network Contributor&#34;</span> <span style="color:#4e9a06">&#34;Managed Identity Operator&#34;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>  az role assignment create --assignee <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_USER_ASSIGNED_CLIENT_ID</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --scope <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">RG_MC_RES</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --role <span style="color:#4e9a06">&#34;</span><span style="color:#000">$role</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">done</span>
</span></span></code></pre></div><h3 id="install-karpenter">Install Karpenter</h3>
<p>Download configuration template and script:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">KARPENTER_VERSION</span><span style="color:#ce5c00;font-weight:bold">=</span>0.7.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Download template</span>
</span></span><span style="display:flex;"><span>curl -sO https://raw.githubusercontent.com/Azure/karpenter-provider-azure/v<span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_VERSION</span><span style="color:#4e9a06">}</span>/hack/deploy/karpenter-values-template.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Download and run configuration script</span>
</span></span><span style="display:flex;"><span>curl -sO https://raw.githubusercontent.com/Azure/karpenter-provider-azure/v<span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_VERSION</span><span style="color:#4e9a06">}</span>/hack/deploy/configure-values.sh
</span></span><span style="display:flex;"><span>chmod +x ./configure-values.sh <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> ./configure-values.sh <span style="color:#4e9a06">${</span><span style="color:#000">CLUSTER_NAME</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">${</span><span style="color:#000">RG</span><span style="color:#4e9a06">}</span> karpenter-sa karpentermsi
</span></span></code></pre></div><p>Install Karpenter using Helm:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm upgrade --install karpenter oci://mcr.microsoft.com/aks/karpenter/karpenter <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --version <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_VERSION</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --namespace <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --create-namespace <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --values karpenter-values.yaml <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set controller.resources.requests.cpu<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set controller.resources.requests.memory<span style="color:#ce5c00;font-weight:bold">=</span>1Gi <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set controller.resources.limits.cpu<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set controller.resources.limits.memory<span style="color:#ce5c00;font-weight:bold">=</span>1Gi <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --wait
</span></span></code></pre></div><h3 id="verify-installation">Verify Installation</h3>
<p>Check Karpenter status:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get pods --namespace <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -l app.kubernetes.io/name<span style="color:#ce5c00;font-weight:bold">=</span>karpenter
</span></span><span style="display:flex;"><span>kubectl logs -f -n <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -l app.kubernetes.io/name<span style="color:#ce5c00;font-weight:bold">=</span>karpenter -c controller
</span></span></code></pre></div><h3 id="create-nodepool">Create NodePool</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: karpenter.sh/v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: NodePool
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: general-purpose
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  template:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      requirements:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - key: kubernetes.io/arch
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          values: [&#34;amd64&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - key: kubernetes.io/os
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          values: [&#34;linux&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - key: karpenter.sh/capacity-type
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          values: [&#34;on-demand&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - key: karpenter.azure.com/sku-family
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          values: [D]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      nodeClassRef:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        group: karpenter.azure.com
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        kind: AKSNodeClass
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        name: default
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      expireAfter: Never
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  limits:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    cpu: 100
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  disruption:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    consolidationPolicy: WhenEmptyOrUnderutilized
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    consolidateAfter: 30s
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">---
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: karpenter.azure.com/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: AKSNodeClass
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: default
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  imageFamily: Ubuntu2204
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><h3 id="test-autoprovisioning-1">Test Autoprovisioning</h3>
<p>Deploy and scale test workload:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: inflate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  replicas: 0
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  selector:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      app: inflate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  template:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      labels:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        app: inflate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      terminationGracePeriodSeconds: 0
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      containers:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        - name: inflate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          image: mcr.microsoft.com/oss/kubernetes/pause:3.6
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">          resources:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">            requests:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">              cpu: 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl scale deployment inflate --replicas <span style="color:#0000cf;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>kubectl logs -f -n <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -l app.kubernetes.io/name<span style="color:#ce5c00;font-weight:bold">=</span>karpenter -c controller
</span></span></code></pre></div><h3 id="clean-up-self-hosted">Clean Up Self-hosted</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete deployment inflate
</span></span><span style="display:flex;"><span>helm uninstall karpenter --namespace <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">KARPENTER_NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>az aks delete --name <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">CLUSTER_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --resource-group <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">RG</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --yes --no-wait
</span></span><span style="display:flex;"><span>az group delete --name <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">RG</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --yes --no-wait
</span></span></code></pre></div><h2 id="whats-next">What&rsquo;s Next?</h2>
<ul>
<li><strong>Learn concepts</strong>: Understand <a href="/docs/concepts/nodepools/">NodePools</a>, <a href="/docs/concepts/nodeclasses/">AKSNodeClasses</a>, and <a href="/docs/concepts/disruption/">disruption policies</a></li>
<li><strong>Advanced configuration</strong>: Explore <a href="../tasks/managing-vm-images/#gpu-images">GPU workloads</a>, <a href="/docs/concepts/nodepools/#spot-instances">spot instances</a>, and <a href="../tasks/managing-vm-images/">custom images</a></li>
<li><strong>Production deployment</strong>: Review <a href="../best-practices/">best practices</a>, <a href="../observability/">monitoring</a>, and <a href="/docs/troubleshooting/">troubleshooting</a></li>
<li><strong>Choose deployment mode</strong>: Read <a href="../concepts/deployment-modes/">NAP vs Self-hosted</a> comparison to understand which mode fits your needs</li>
</ul>
<h2 id="common-next-steps">Common Next Steps</h2>
<h3 id="enable-spot-instances">Enable Spot Instances</h3>
<p>Add spot instance support to reduce costs:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">karpenter.sh/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">NodePool</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">spot-nodepool</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">requirements</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">karpenter.sh/capacity-type</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">In</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;spot&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;on-demand&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Prefer spot, fallback to on-demand</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">karpenter.azure.com/sku-family</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">In</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;D&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;E&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;F&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">nodeClassRef</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">disruption</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">consolidationPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WhenUnderutilized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="add-gpu-support">Add GPU Support</h3>
<p>Configure GPU workloads:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">karpenter.sh/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">NodePool</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gpu-nodepool</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">requirements</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">karpenter.azure.com/sku-gpu-count</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Gt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">karpenter.azure.com/sku-gpu-manufacturer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">In</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;nvidia&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">nodeClassRef</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gpu-nodeclass</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="multi-architecture-support">Multi-Architecture Support</h3>
<p>Support both AMD64 and ARM64:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">karpenter.sh/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">NodePool</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">multi-arch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">requirements</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kubernetes.io/arch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">In</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;amd64&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;arm64&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">karpenter.azure.com/sku-family</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">In</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;D&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Dpds&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Dpds for ARM64</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="getting-help">Getting Help</h2>
<ul>
<li><strong>Documentation</strong>: Browse the complete <a href="/docs/">documentation</a></li>
<li><strong>GitHub Issues</strong>: Report bugs or request features on <a href="https://github.com/Azure/karpenter-provider-azure/issues">GitHub</a></li>
<li><strong>Community</strong>: Join the <a href="https://kubernetes.slack.com/archives/C02SFFZSA2K">#karpenter</a> channel in Kubernetes Slack</li>
<li><strong>Examples</strong>: Explore more examples in the <a href="https://github.com/Azure/karpenter-provider-azure/tree/main/examples">repository</a></li>
</ul>

	
	
	
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
          
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
          
            
  <ul class="list-inline mb-0">
    
      <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
        <a class="text-white" target="_blank" rel="noopener" href="https://github.com/Azure/karpenter-provider-azure" aria-label="GitHub">
          <i class="fab fa-github"></i>
        </a>
      </li>
    
      <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
        <a class="text-white" target="_blank" rel="noopener" href="https://slack.k8s.io/" aria-label="Slack">
          <i class="fab fa-slack"></i>
        </a>
      </li>
    
  </ul>

          
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2025 Microsoft Corporation or its affiliates. All Rights Reserved</small>
        
        
      </div>
    </div>
  </div>
</footer>


    </div>
    
  <script src="/js/main.js"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>